FROM gradle:6.0.1-jdk11 AS build

RUN printenv

ARG SWAGGER_USER
ARG SWAGGER_PASSWORD

ENV SWAGGER_USER=${SWAGGER_USER}
ENV SWAGGER_PASSWORD=${SWAGGER_PASSWORD}
ENV DB_CONNECTION_STRING=jdbc:h2:mem:testdb
COPY --chown=gradle:gradle web/v2/backend /home/gradle/src
WORKDIR /home/gradle/src
RUN gradle build --no-daemon

FROM openjdk:11-jre-slim

ARG SWAGGER_USER
ARG SWAGGER_PASSWORD
ARG DB_CONNECTION_STRING
ENV DB_CONNECTION_STRING=${DB_CONNECTION_STRING}
ENV SWAGGER_USER=${SWAGGER_USER}
ENV SWAGGER_PASSWORD=${SWAGGER_PASSWORD}
ARG MYSQL_USER
ARG MYSQL_PASSWORD
ENV MYSQL_USER=${MYSQL_USER}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}

EXPOSE 34345

RUN mkdir /app

COPY --from=build /home/gradle/src/build/libs/*.jar app.jar

ENTRYPOINT ["java","-jar","/app.jar"]
